// 慈濟據點地址資料庫
export const TZU_CHI_LOCATIONS = {
  // 台中市
  "台中市大里區-台中分會": "台中市大里區公教街136巷6號",
  "台中市北屯區-台中分會": "台中市北屯區文心路四段831號",
  "台中市北區-台中分會": "台中市北區中清路一段79號12樓之1",
  "台中市西屯區-台中分會": "臺中市西屯區台灣大道二段715號4樓之1",
  "台中市西區-台中分會": "臺中市西區民生路200號7樓",
  "台中市東區-台中分堂": "台中市東區樂業路280號3樓",
  "台中市南屯區-台中分會": "台中市南屯路2段290號14F-2",
  "台中市南區-台中分會": "台中市南區五權南路99號1樓",
  "台中市清水區-梧棲童綜合醫院": "臺中市梧棲區臺灣大道八段699號",
  "台中市清水區-清水靜思堂": "臺中市清水區五權路267號",
  "台中市豐原區-豐原靜思堂": "台中市豐原區自強南街77號1樓",

  // 台北市
  "台北市內湖區-內湖聯絡處": "臺北市內湖區內湖路二段355巷21號2樓",
  "台北市大同區-台北分會": "台北市大同區承德路一段35號7樓之1",
  "台北市大安區-台北東區聯絡處": "台北市大安區忠孝東路三段217巷7弄35號",
  "台北市中山區-台北分會": "台北市大安區金山南路二段200號6樓",
  "台北市中正區-中正萬華聯絡處": "台北市萬華區艋舺大道116號",
  "台北市信義區-東區聯絡處": "臺北市信義區松隆路327號３樓",
  "台北市松山區-松山聯絡處": "臺北市南京東路5段188號16樓",

  // 台南市
  "台南市中西區-台南分會": "台南市中西區成功路457號9樓之1",
  "台南市仁德區-台南分會": "台南市仁德區仁義路222號",
  "台南市安平區-台南分會慈濟中學": "臺南市安平區建平五街111號",
  "台南市永康區-台南分會": "台南市永康區大灣路796號4F",
  "台南市善化區-台南分會": "台南市善化區中山路353號",
  "台南市新營區-台南分會": "台南市新營區三民路53-1號",
  "台南市歸仁區-台南分會": "臺南市歸仁區民生北街130號3F禮堂",

  // 台東縣
  "台東縣台東市-台東聯絡處": "臺東縣臺東市長沙街59號",
  "台東縣關山鎮-關山慈濟醫院": "臺東縣關山鎮和平路125-5號",

  // 花蓮縣
  "花蓮縣吉安鄉-花蓮本會": "花蓮縣吉安鄉福興村福德街1號",
  "花蓮縣吉安鄉-花蓮靜思堂": "花蓮縣吉安鄉中央路三段701號",
  "花蓮縣玉里鎮-玉里慈濟醫院": "花蓮縣玉里鎮民權街1-1號",
  "花蓮縣花蓮市-花蓮分會": "花蓮縣花蓮市中央路三段703號",
  "花蓮縣花蓮市-花蓮靜思堂（園區）": "花蓮縣花蓮市中央路三段701號",
  "花蓮縣新城鄉-花蓮本會": "花蓮縣新城鄉康樂村精舍街88巷1號",
  "花蓮縣新城鄉-花蓮靜思堂": "花蓮縣新城鄉康樂村精舍街88巷1號",

  // 宜蘭縣
  "宜蘭縣羅東鎮-羅東聯絡處": "宜蘭縣羅東鎮中正北路118號",

  // 屏東縣
  "屏東縣長治鄉-屏東分會": "屏東縣長治鄉長興路401-1號",
  "屏東縣恆春鎮-恆春基督教醫院-宗教處-雲南": "屏東縣恆春鎮恆西路21號",
  "屏東縣屏東市-屏東分會": "屏東縣屏東市棒球路57之1號2樓",
  "屏東縣東港鎮-東港聯絡處": "東港鎮中山路60號1樓",

  // 彰化縣
  "彰化縣埔心鄉-員林靜思堂": "彰化縣員林市靜修路73號",
  "彰化縣彰化市-彰化靜思堂": "彰化縣秀水鄉馬鳴段一二八六、一二八七",

  // 桃園市
  "桃園市八德區-桃園分會": "桃園市八德區興豐路1139號1樓",
  "桃園市中壢區-中壢園區聯絡處": "桃園市中壢區環中東路701號",
  "桃園市桃園區-桃園靜思堂": "桃園市桃園區大業路一段307號",
  "桃園市蘆竹區-桃園分會": "桃園市蘆竹區中正路255號3樓",

  // 高雄市
  "高雄市小港區-高雄靜思堂": "高雄市小港區平和路201號",
  "高雄市岡山區-高雄志業園區": "高雄市岡山區岡山路501巷10號",
  "高雄市前金區-高雄靜思堂": "高雄市前金區中華三路77號",
  "高雄市前鎮區-高雄志業園區": "高雄市前鎮區復興三路132號",
  "高雄市苓雅區-高雄苓雅-三民-鼓山聯絡處": "高雄市苓雅區四維三路8號",
  "高雄市楠梓區-高雄楠梓聯絡處": "高雄市楠梓區後昌路803號",
  "高雄市鼓山區-高雄靜思堂": "高雄市鼓山區中華一路605號",

  // 基隆市
  "基隆市信義區-基隆靜思堂": "基隆市安樂區樂利三街150號A棟1樓",

  // 雲林縣
  "雲林縣斗六市-斗六聯絡處": "雲林縣斗六市大學路三段123號",
  "雲林縣麥寮鄉-麥寮聯絡處": "雲林縣麥寮鄉中山路422號",

  // 新北市
  "新北市三重區-三重園區聯絡處": "新北市三重區中正北路450號",
  "新北市中和區-台北分會": "新北市中和區中山路三段41號",
  "新北市永和區-台北分會": "新北市永和區永和路二段100號後棟四樓",
  "新北市汐止區-台北分會": "新北市汐止區中正路239號",
  "新北市板橋區-板橋志業園區": "新北市板橋區大觀路二段265巷15號",
  "新北市新店區-台北分會": "新北市新店區新烏路一段26巷35號之2",

  // 新竹市/縣
  "新竹市東區-新竹聯絡處": "新竹市香山區中華路五段208巷20號",
  "新竹縣竹北市-新竹靜思堂": "新竹市中華路五段208巷20號",

  // 嘉義市/縣
  "嘉義市西區-嘉義聯絡處": "嘉義市西區驛站里1鄰仁愛路383號1樓",
  "嘉義縣大林鎮-大林慈濟醫院": "嘉義縣大林鎮民生路二號",
  "嘉義縣朴子市-朴子聯絡處": "嘉義縣朴子市安福里文明路3-5號"
};

// 獲取所有據點名稱（用於搜尋建議）
export function getTzuChiLocationNames() {
  return Object.keys(TZU_CHI_LOCATIONS);
}

// 根據據點名稱獲取詳細地址
export function getTzuChiAddress(locationName) {
  return TZU_CHI_LOCATIONS[locationName] || null;
}

// 模糊搜尋據點名稱
export function searchTzuChiLocations(query) {
  if (!query || query.length < 2) return [];
  
  const lowerQuery = query.toLowerCase();
  const results = [];
  
  Object.keys(TZU_CHI_LOCATIONS).forEach(locationName => {
    const lowerName = locationName.toLowerCase();
    
    // 精確匹配優先
    if (lowerName === lowerQuery) {
      results.unshift({ name: locationName, address: TZU_CHI_LOCATIONS[locationName], priority: 1 });
    }
    // 開頭匹配次優先
    else if (lowerName.startsWith(lowerQuery)) {
      results.push({ name: locationName, address: TZU_CHI_LOCATIONS[locationName], priority: 2 });
    }
    // 包含匹配最後
    else if (lowerName.includes(lowerQuery)) {
      results.push({ name: locationName, address: TZU_CHI_LOCATIONS[locationName], priority: 3 });
    }
  });
  
  // 按優先級排序，同優先級按名稱排序
  return results.sort((a, b) => {
    if (a.priority !== b.priority) return a.priority - b.priority;
    return a.name.localeCompare(b.name);
  });
}

// 自動替換地址（核心功能）
export function replaceWithTzuChiAddress(inputAddress) {
  if (!inputAddress || typeof inputAddress !== 'string') return inputAddress;
  
  const trimmedInput = inputAddress.trim();
  
  // 檢查是否為慈濟據點名稱
  const exactMatch = getTzuChiAddress(trimmedInput);
  if (exactMatch) {
    return exactMatch;
  }
  
  // 模糊匹配，如果只有一個結果且相似度高，則替換
  const searchResults = searchTzuChiLocations(trimmedInput);
  if (searchResults.length === 1 && searchResults[0].priority <= 2) {
    return searchResults[0].address;
  }
  
  // 否則返回原地址
  return inputAddress;
}

// 檢查輸入是否可能是慈濟據點名稱
export function isTzuChiLocationName(inputAddress) {
  if (!inputAddress || typeof inputAddress !== 'string') return false;
  
  const trimmedInput = inputAddress.trim().toLowerCase();
  
  // 包含慈濟相關關鍵字
  const tzuChiKeywords = ['慈濟', '靜思堂', '分會', '聯絡處', '本會', '園區'];
  return tzuChiKeywords.some(keyword => trimmedInput.includes(keyword));
}